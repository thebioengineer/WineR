---
title: "What makes a Wine"
author: "Ellis Hughes"
date: "March 14, 2018"
output:
  html_document:
    keep_md: true
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = TRUE,message=FALSE,warning=FALSE)
wineData<-read.csv("../winemag-data-130k-v2.csv",header = TRUE,stringsAsFactors = FALSE)
```

## Planting the Seeds

My first "real" job after college was working for a winery. Some of you may have heard of this one; E&J Gallo Winery. I was just an intern, and didn't really have much of an appreciation for wine and the industry. About all I knew was that I liked the taste, and it was a classy thing to order when I took my girlfriend (now wife) out to dinner. And if you asked me to tell you the difference between a cabernet sauvignon and a pinot grigio, about all I could say that one was red. 

Since that time I have learned that the wine industry is one with many layers and traditions. Some chateaus have existed for centuries, with their books recording sales from medieval times. 

One of the greatest things I learned from my internship was how to taste wine. I am no sommelier, but at least after that class I was able to identify what I liked or disliked about the various wines I would try. 

Spurred by a recent watching of the plethora of wine documentaries that can be found on Netflix nowadays, I started thinking about wine again. This time though the eyes of a data scientist. I started to wonder about the scores, what makes a great vintage, and much else. 

Thankfully I have not been the only one. Rather than developing my own web-scraper to pull data from the various websites that contain wine scores, I found a csv generated by [Zack Thoutt]("https://www.kaggle.com/zynicide/wine-reviews/data") in late 2017 that would be the basis of my analysis. 

It contains 129971 observations, of 13 variables. Zack thoughtfully scraped out information such as province to the cost of the bottle and the score it received. 

## Scoring

### Countries of Excellence
Wine scoring is an interesting exercise in trying to distill many different descriptors of wine into a number to help someone that may not be so knowledgeable about wine know if they are getting a "good one". My first question is whether there is any bias in scoring. Will wines that are produced from the traditional wine producing regions be more likely to receive a higher score?


```{r PointsVsCountry, echo=FALSE}
library(tidyverse)
library(ggplot2)
winescoring<-wineData%>%
  group_by(country)%>%
  filter(n()>1000)%>%
  select(country,points)

orderedWineScoring<-winescoring%>%
  summarise(
    nReviews=n(),
    Min=min(points),
    Q_1=quantile(points,.25),
    Mean=mean(points),
    Median=median(points),
    Q_3=quantile(points,.75),
    Max=max(points),
    SD=sd(points))%>%
  arrange(Mean)

kable(orderedWineScoring)

winescoring%>%ungroup()%>%mutate(country=factor(country,levels=as.character(orderedWineScoring$country)))%>%
ggplot()+geom_boxplot(aes(y=points,x=country,fill=country))+ggtitle("Wine Scores by Country")+xlab("Country")+ylab("Wine Magazine Score")

```

Surprisingly, France did not have the highest average, Austria did. Now, this is likely due to my ignorance of historical wine industries, but I had always thought of France before thinking of Germany and Austria as premier wine producing regions. This may be from the Burgundy region of France, but Further digging is needed

### Bottles on a budget

My next curiosity was whether quality wine can be purchased without breaking the bank. In the documentary SOMM:Out of the bottle, one of the sommeliers said you can find great bottles at $20/bottle. Lets put this to the test. Per [statista.com]("https://www.statista.com/statistics/259433/average-price-of-leading-types-of-wine-in-the-us/"), the average cost of a bottle purchased in the United States was USD8.98. Lets make the cuts at 0-10,11-15,16-20,21-35,35+. These cuts are rather arbitrary, but represent where I would personally draw the lines between cooking wine, every day wine, nice wine, wine I am trying to impress with, and wine I will probably never buy!


```{r PointsVsPrice, echo=FALSE}
library(tidyverse)
library(ggplot2)
winescoring<-wineData%>%
  filter(!is.na(price))%>%
  mutate(priceSplits=cut(price, breaks=c(-Inf, 10 , 15, 20, 35, Inf), labels=c("$0-$10","$10-15","$16-20","$21-35","$35+")))%>%
  select(priceSplits,points,price,title)

orderedWineScoring<-winescoring%>%
  group_by(priceSplits)%>%
  summarise(
    nReviews=n(),
    Min=min(points),
    Q_1=quantile(points,.25),
    Mean=mean(points),
    Median=median(points),
    Q_3=quantile(points,.75),
    Max=max(points))%>%
  arrange(Mean)

kable(orderedWineScoring)

winescoring%>%ungroup()%>%
ggplot()+geom_point(aes(y=points,x=price,color=priceSplits))+ggtitle("Wine Scores by Price")+xlab("Price($)")+ylab("Wine Magazine Score")+scale_x_log10()

```

This data and plot seems to indicate what you would expect; the more you spend, the more likely the bottle is to be highly rated. However, you do not have to spend all the money you have in your alcohol budget for the month to impress your date. The highest rating for the \$15-20s bottles was a whopping 96 points, only 1 point less than the highest ratings \$21-35 range. This bottle happens to be from my home state of Washington, and is the 2007 Rulo Syrah (Columbia Valley). I will have to see if I can find any of its cousins around!

### Points on the Vine

My final curiosity was whether certain varietals were predisposed to a higher score. The wine data I have has over 700 varietals, so I will keep only those with over 3000 entries in the data. This should limit us to the main varietals. 


```{r PointsVsVarietal, echo=FALSE}
winescoring<-wineData%>%
  group_by(variety)%>%
  filter(n()>3000)%>%
  select(variety,points)

orderedWineScoring<-winescoring%>%
  summarise(
    nReviews=n(),
    Min=min(points),
    Q_1=quantile(points,.25),
    Mean=mean(points),
    Median=median(points),
    Q_3=quantile(points,.75),
    Max=max(points),
    SD=sd(points))%>%
  arrange(desc(Mean))

kable(orderedWineScoring)

winescoring%>%ungroup()%>%mutate(variety=factor(variety,levels=as.character(orderedWineScoring$variety)))%>%
ggplot()+geom_boxplot(aes(y=points,x=variety,fill=variety))+ggtitle("Wine Scores by Variety")+xlab("Varietal")+ylab("Wine Magazine Score")


```


Unsurprisingly, most of the top tastes wine types were reds. However, the highest rated overall was the Riesling. While I really enjoy Rieslings, I know many that find them sweet. That could be the price range that I am typically in though! Lets see how ratings and price relate for these top varietals.

```{r PointsVsVarietalvs Price, echo=FALSE}
winescoring<-wineData%>%
  group_by(variety)%>%
  filter(n()>3000,!is.na(price))%>%
  select(variety,points,price)

winescoring%>%ungroup()%>%mutate(variety=factor(variety,levels=as.character(orderedWineScoring$variety)))%>%
ggplot()+geom_point(aes(y=points,x=price,color=variety))+ggtitle("Wine Scores by Variety and Price")+xlab("Price($)")+ylab("Wine Magazine Score")+scale_x_log10()

